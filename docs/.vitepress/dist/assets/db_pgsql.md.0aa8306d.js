import{_ as s,c as a,o as n,a as p}from"./app.f8e37f6d.js";const F=JSON.parse('{"title":"Postgresql","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u521B\u5EFA\u5BB9\u5668","slug":"\u521B\u5EFA\u5BB9\u5668"},{"level":2,"title":"\u57FA\u7840\u64CD\u4F5C","slug":"\u57FA\u7840\u64CD\u4F5C"},{"level":2,"title":"\u6570\u636E\u5E93\u5907\u4EFD","slug":"\u6570\u636E\u5E93\u5907\u4EFD"},{"level":2,"title":"\u6570\u636E\u5E93\u8FD8\u539F","slug":"\u6570\u636E\u5E93\u8FD8\u539F"},{"level":2,"title":"\u6570\u636E\u5E93\u540C\u6B65","slug":"\u6570\u636E\u5E93\u540C\u6B65"}],"relativePath":"db/pgsql.md"}'),l={name:"db/pgsql.md"},e=p(`<h1 id="postgresql" tabindex="-1">Postgresql <a class="header-anchor" href="#postgresql" aria-hidden="true">#</a></h1><h2 id="\u521B\u5EFA\u5BB9\u5668" tabindex="-1">\u521B\u5EFA\u5BB9\u5668 <a class="header-anchor" href="#\u521B\u5EFA\u5BB9\u5668" aria-hidden="true">#</a></h2><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ docker run -d \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --name pgsql \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --env POSTGRES_DB=postgres \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --env POSTGRES_USER=postgres \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --env POSTGRES_PASSWORD=Ab123456 \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --network web \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --ip 172.16.0.54 \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    -p 5432:5432 \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    -v /var/web/service/pgsql/conf:/etc/postgresql \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    -v /var/web/service/pgsql/log:/var/log/postgresql \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    -v /var/web/service/pgsql/data:/var/lib/postgresql/data \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    -v /var/web/service/pgsql/backup:/var/lib/postgresql/backup \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --restart always \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    postgres:13-alpine</span></span>
<span class="line"></span></code></pre></div><h2 id="\u57FA\u7840\u64CD\u4F5C" tabindex="-1">\u57FA\u7840\u64CD\u4F5C <a class="header-anchor" href="#\u57FA\u7840\u64CD\u4F5C" aria-hidden="true">#</a></h2><p>\u547D\u4EE4\u7A97\u53E3</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ psql -U postgres</span></span>
<span class="line"></span></code></pre></div><p>\u521B\u5EFA\u6570\u636E\u5E93</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ CREATE DATABASE dbname</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ docker </span><span style="color:#82AAFF;">exec</span><span style="color:#A6ACCD;"> pgsql createdb -h localhost -U postgres</span></span>
<span class="line"></span></code></pre></div><p>\u5220\u9664\u6570\u636E\u5E93</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ DROP DATABASE </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">\u8868\u540D</span><span style="color:#89DDFF;">];</span></span>
<span class="line"></span></code></pre></div><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ docker </span><span style="color:#82AAFF;">exec</span><span style="color:#A6ACCD;"> pgsql dropdb -h localhost -U postgres --if-exists dbname</span></span>
<span class="line"></span></code></pre></div><p>\u91CD\u547D\u540D\u4E00\u4E2A\u8868</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ alter table </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">\u8868\u540DA</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> rename to </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">\u8868\u540DB</span><span style="color:#89DDFF;">];</span></span>
<span class="line"></span></code></pre></div><p>\u5220\u9664\u4E00\u4E2A\u8868</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ drop table </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">\u8868\u540D</span><span style="color:#89DDFF;">];</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u5DF2\u6709\u7684\u8868\u91CC\u6DFB\u52A0\u5B57\u6BB5</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ alter table </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">\u8868\u540D</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> add column </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">\u5B57\u6BB5\u540D</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">\u7C7B\u578B</span><span style="color:#89DDFF;">];</span></span>
<span class="line"></span></code></pre></div><p>\u5220\u9664\u8868\u4E2D\u7684\u5B57\u6BB5</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ alter table </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">\u8868\u540D</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> drop column </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">\u5B57\u6BB5\u540D</span><span style="color:#89DDFF;">];</span></span>
<span class="line"></span></code></pre></div><p>\u91CD\u547D\u540D\u4E00\u4E2A\u5B57\u6BB5</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ alter table </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">\u8868\u540D</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> alter column </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">\u5B57\u6BB5\u540D</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;"> default </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">\u65B0\u7684\u9ED8\u8BA4\u503C</span><span style="color:#89DDFF;">];</span></span>
<span class="line"></span></code></pre></div><p>\u53BB\u9664\u7F3A\u7701\u503C</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ alter table </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">\u8868\u540D</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> alter column </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">\u5B57\u6BB5\u540D</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> drop default</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="\u6570\u636E\u5E93\u5907\u4EFD" tabindex="-1">\u6570\u636E\u5E93\u5907\u4EFD <a class="header-anchor" href="#\u6570\u636E\u5E93\u5907\u4EFD" aria-hidden="true">#</a></h2><p><a href="http://backup.sh" target="_blank" rel="noopener noreferrer">backup.sh</a> dbname</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Database name</span></span>
<span class="line"><span style="color:#A6ACCD;">database=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">path=/var/lib/postgresql/backup</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Backup file name</span></span>
<span class="line"><span style="color:#A6ACCD;">filename=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">database</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">_</span><span style="color:#89DDFF;">$(</span><span style="color:#C3E88D;">date </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">+%Y%m%d-%H%M%S</span><span style="color:#89DDFF;">&quot;)</span><span style="color:#A6ACCD;">.bak</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Backing up</span></span>
<span class="line"><span style="color:#A6ACCD;">docker </span><span style="color:#82AAFF;">exec</span><span style="color:#A6ACCD;"> pgsql pg_dump -h localhost -U postgres -d </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">database</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> -Fc -f </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">The </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">database</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> database backup success to </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">}&quot;</span></span>
<span class="line"></span></code></pre></div><h2 id="\u6570\u636E\u5E93\u8FD8\u539F" tabindex="-1">\u6570\u636E\u5E93\u8FD8\u539F <a class="header-anchor" href="#\u6570\u636E\u5E93\u8FD8\u539F" aria-hidden="true">#</a></h2><p><a href="http://restore.sh" target="_blank" rel="noopener noreferrer">restore.sh</a> dbname filepath</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">database=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">filepath=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">2</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># restore</span></span>
<span class="line"><span style="color:#A6ACCD;">docker </span><span style="color:#82AAFF;">exec</span><span style="color:#A6ACCD;"> pgsql pg_restore -h localhost -U postgres -p 5432 -d </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">database</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">filepath</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="\u6570\u636E\u5E93\u540C\u6B65" tabindex="-1">\u6570\u636E\u5E93\u540C\u6B65 <a class="header-anchor" href="#\u6570\u636E\u5E93\u540C\u6B65" aria-hidden="true">#</a></h2><p><a href="http://sync.sh" target="_blank" rel="noopener noreferrer">sync.sh</a> fromDatabase toDatabase</p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">fromDatabase=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">toDatabase=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">2</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">filepath=/tmp/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">fromDatabase</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">.bak</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># backup db</span></span>
<span class="line"><span style="color:#A6ACCD;">docker </span><span style="color:#82AAFF;">exec</span><span style="color:#A6ACCD;"> pgsql pg_dump -h localhost -U postgres -d </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">fromDatabase</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> -Fc -f </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">filepath</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># drop db</span></span>
<span class="line"><span style="color:#A6ACCD;">docker </span><span style="color:#82AAFF;">exec</span><span style="color:#A6ACCD;"> pgsql dropdb -h localhost -U postgres --if-exists </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">toDatabase</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># create db</span></span>
<span class="line"><span style="color:#A6ACCD;">docker </span><span style="color:#82AAFF;">exec</span><span style="color:#A6ACCD;"> pgsql createdb -h localhost -U postgres </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">toDatabase</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># restore db</span></span>
<span class="line"><span style="color:#A6ACCD;">docker </span><span style="color:#82AAFF;">exec</span><span style="color:#A6ACCD;"> pgsql pg_restore -h localhost -U postgres -p 5432 -d </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">toDatabase</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">filepath</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># delete tmp file</span></span>
<span class="line"><span style="color:#A6ACCD;">rm -f </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">filepath</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ docker run -d \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --name pgadmin \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --network web \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --ip 172.16.0.200 \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    -e </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">PGADMIN_DEFAULT_EMAIL=928988368@qq.com</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    -e </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">PGADMIN_DEFAULT_PASSWORD=sK3qV6fO3nU7gJ1o</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    -e </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">PGADMIN_CONFIG_ENHANCED_COOKIE_PROTECTION=True</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    -e </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">PGADMIN_CONFIG_LOGIN_BANNER=&quot;Authorised users only!&quot;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    -e </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">PGADMIN_CONFIG_CONSOLE_LOG_LEVEL=10</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    dpage/pgadmin4</span></span>
<span class="line"></span></code></pre></div>`,34),o=[e];function c(t,r,D,A,y,C){return n(),a("div",null,o)}var d=s(l,[["render",c]]);export{F as __pageData,d as default};
