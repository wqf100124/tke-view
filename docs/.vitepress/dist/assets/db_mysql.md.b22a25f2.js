import{_ as s,c as a,o as n,a as l}from"./app.f8e37f6d.js";const F=JSON.parse('{"title":"Mysql","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u521B\u5EFA\u5BB9\u5668","slug":"\u521B\u5EFA\u5BB9\u5668"},{"level":2,"title":"\u6570\u636E\u5E93\u5907\u4EFD","slug":"\u6570\u636E\u5E93\u5907\u4EFD"},{"level":2,"title":"Mysql\u6570\u636E\u5E93\u81EA\u52A8\u5907\u4EFD","slug":"mysql\u6570\u636E\u5E93\u81EA\u52A8\u5907\u4EFD"},{"level":3,"title":"1\u3001\u7F16\u5199.sh\u811A\u672C \u53E6\u5B58\u4E3A backup.sh","slug":"_1\u3001\u7F16\u5199-sh\u811A\u672C-\u53E6\u5B58\u4E3A-backup-sh"},{"level":3,"title":"2\u3001\u4F7F\u811A\u672C\u5177\u6709\u6267\u884C\u6743\u9650","slug":"_2\u3001\u4F7F\u811A\u672C\u5177\u6709\u6267\u884C\u6743\u9650"},{"level":3,"title":"3\u3001\u6DFB\u52A0\u8BA1\u5212\u4EFB\u52A1","slug":"_3\u3001\u6DFB\u52A0\u8BA1\u5212\u4EFB\u52A1"},{"level":3,"title":"4\u3001\u5E38\u89C1\u95EE\u9898","slug":"_4\u3001\u5E38\u89C1\u95EE\u9898"}],"relativePath":"db/mysql.md"}'),p={name:"db/mysql.md"},o=l(`<h1 id="mysql" tabindex="-1">Mysql <a class="header-anchor" href="#mysql" aria-hidden="true">#</a></h1><h2 id="\u521B\u5EFA\u5BB9\u5668" tabindex="-1">\u521B\u5EFA\u5BB9\u5668 <a class="header-anchor" href="#\u521B\u5EFA\u5BB9\u5668" aria-hidden="true">#</a></h2><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ docker run -d \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --name mysql \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --env MYSQL_ROOT_HOST=% \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --env MYSQL_ROOT_PASSWORD=Ab123456 \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --network web \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --ip 172.16.0.33 \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    -p 3306:3306 \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    -v /var/web/service/mysql:/var/lib/mysql \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    --restart always \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    mysql:5.7</span></span>
<span class="line"></span></code></pre></div><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ docker </span><span style="color:#82AAFF;">exec</span><span style="color:#A6ACCD;"> mysql </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sql_mode=STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> /etc/mysql/conf.d/mysql.cnf</span></span>
<span class="line"></span></code></pre></div><h2 id="\u6570\u636E\u5E93\u5907\u4EFD" tabindex="-1">\u6570\u636E\u5E93\u5907\u4EFD <a class="header-anchor" href="#\u6570\u636E\u5E93\u5907\u4EFD" aria-hidden="true">#</a></h2><p><a href="http://backup.sh" target="_blank" rel="noopener noreferrer">backup.sh</a></p><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">#!/bin/bash</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># database</span></span>
<span class="line"><span style="color:#A6ACCD;">database=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">backup_path=/var/web/backup/database</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u6587\u4EF6\u540D\u79F0</span></span>
<span class="line"><span style="color:#A6ACCD;">file=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">backup_path/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">database</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">_</span><span style="color:#89DDFF;">$(</span><span style="color:#C3E88D;">date </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">+%Y_%m_%d_%H_%M_%S</span><span style="color:#89DDFF;">&quot;)</span><span style="color:#A6ACCD;">.sql</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u5907\u4EFD</span></span>
<span class="line"><span style="color:#A6ACCD;">docker </span><span style="color:#82AAFF;">exec</span><span style="color:#A6ACCD;"> mysql mysqldump -u root -paiguangjii </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">database </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">file</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u6253\u5305</span></span>
<span class="line"><span style="color:#A6ACCD;">tar -czf </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">file.tar.gz </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">file</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u5220\u9664\u65E7\u6587\u4EF6</span></span>
<span class="line"><span style="color:#A6ACCD;">rm </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">file</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u6570\u636E\u5E93</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">database</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;">\u5907\u4EFD\u6210\u529F</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Database name</span></span>
<span class="line"><span style="color:#A6ACCD;">database=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">path=/var/lib/postgresql/backup</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Backup file name</span></span>
<span class="line"><span style="color:#A6ACCD;">filename=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">database</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">_</span><span style="color:#89DDFF;">$(</span><span style="color:#C3E88D;">date </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">+%Y%m%d-%H%M%S</span><span style="color:#89DDFF;">&quot;)</span><span style="color:#A6ACCD;">.bak</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Backing up</span></span>
<span class="line"><span style="color:#A6ACCD;">docker </span><span style="color:#82AAFF;">exec</span><span style="color:#A6ACCD;"> mysql mysqldump -u root -paiguangjii </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">database </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">file</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">The </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">database</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> database backup was successful!</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><h2 id="mysql\u6570\u636E\u5E93\u81EA\u52A8\u5907\u4EFD" tabindex="-1">Mysql\u6570\u636E\u5E93\u81EA\u52A8\u5907\u4EFD <a class="header-anchor" href="#mysql\u6570\u636E\u5E93\u81EA\u52A8\u5907\u4EFD" aria-hidden="true">#</a></h2><h3 id="_1\u3001\u7F16\u5199-sh\u811A\u672C-\u53E6\u5B58\u4E3A-backup-sh" tabindex="-1">1\u3001\u7F16\u5199.sh\u811A\u672C \u53E6\u5B58\u4E3A <a href="http://backup.sh" target="_blank" rel="noopener noreferrer">backup.sh</a> <a class="header-anchor" href="#_1\u3001\u7F16\u5199-sh\u811A\u672C-\u53E6\u5B58\u4E3A-backup-sh" aria-hidden="true">#</a></h3><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">#!/bin/bash</span></span>
<span class="line"><span style="color:#A6ACCD;">count=0</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u6587\u4EF6\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#A6ACCD;">path=/home/web/backup/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u5FAA\u73AF</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> db </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> xyun1688 xyuntest</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">do</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;"># \u6587\u4EF6\u540D\u79F0</span></span>
<span class="line"><span style="color:#A6ACCD;">	file=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">db</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">_</span><span style="color:#89DDFF;">$(</span><span style="color:#C3E88D;">date </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">+%Y_%m_%d_%H_%M_%S</span><span style="color:#89DDFF;">&quot;)</span><span style="color:#A6ACCD;">.sql</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;"># \u5907\u4EFD</span></span>
<span class="line"><span style="color:#A6ACCD;">	mysqldump -u root -paiguangjii </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">database </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">file</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;"># \u6253\u5305</span></span>
<span class="line"><span style="color:#A6ACCD;">	tar -czvf </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">file.tar.gz </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">file</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;"># \u5220\u9664\u65E7\u6587\u4EF6</span></span>
<span class="line"><span style="color:#A6ACCD;">	/bin/rm </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">file</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">((</span><span style="color:#C3E88D;">count</span><span style="color:#89DDFF;">++))</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u6570\u636E\u5E93</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">db</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;">\u5907\u4EFD\u6210\u529F</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">done</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u5907\u4EFD\u5B8C\u6210</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u5DF2\u5B8C\u6210</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">count</span><span style="color:#C3E88D;">\u4E2A\u6570\u636E\u5E93\u7684\u5907\u4EFD</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u5220\u9664\u8D85\u8FC7\u65F6\u95F4\u7684\u5907\u4EFD\u6587\u4EF6</span></span>
<span class="line"><span style="color:#A6ACCD;">day=3</span></span>
<span class="line"><span style="color:#A6ACCD;">find </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">path -mtime +</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">day -type f -name </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*.gz</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> -exec rm -f {} \\;</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;$</span><span style="color:#A6ACCD;">day</span><span style="color:#C3E88D;">\u5929\u524D\u7684\u5907\u4EFD\u6570\u636E\u5DF2\u5220\u9664</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><h3 id="_2\u3001\u4F7F\u811A\u672C\u5177\u6709\u6267\u884C\u6743\u9650" tabindex="-1">2\u3001\u4F7F\u811A\u672C\u5177\u6709\u6267\u884C\u6743\u9650 <a class="header-anchor" href="#_2\u3001\u4F7F\u811A\u672C\u5177\u6709\u6267\u884C\u6743\u9650" aria-hidden="true">#</a></h3><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">chmod +x /data/sh/db/backup.sh</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u6216cd\u5230\u5F53\u524D\u811A\u672C\u547D\u4EE4\u76EE\u5F55\u8FD0\u884C\uFF1A</span></span>
<span class="line"><span style="color:#A6ACCD;">chmod +x ./backup.sh</span></span>
<span class="line"></span></code></pre></div><h3 id="_3\u3001\u6DFB\u52A0\u8BA1\u5212\u4EFB\u52A1" tabindex="-1">3\u3001\u6DFB\u52A0\u8BA1\u5212\u4EFB\u52A1 <a class="header-anchor" href="#_3\u3001\u6DFB\u52A0\u8BA1\u5212\u4EFB\u52A1" aria-hidden="true">#</a></h3><div class="language-sh"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">crontab -e</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u6BCF\u5929 3 \u70B9\u949F\u6267\u884C\u5907\u4EFD</span></span>
<span class="line"><span style="color:#A6ACCD;">01   3 </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> root/home/backup/DatabaseName.sh</span></span>
<span class="line"></span></code></pre></div><h3 id="_4\u3001\u5E38\u89C1\u95EE\u9898" tabindex="-1">4\u3001\u5E38\u89C1\u95EE\u9898 <a class="header-anchor" href="#_4\u3001\u5E38\u89C1\u95EE\u9898" aria-hidden="true">#</a></h3><h4 id="_1\u3001sh\u811A\u672C\u62A5\u9519\u201C-m-bad-interpreter\u201D\u89E3\u51B3\u65B9\u6CD5" tabindex="-1">1\u3001sh\u811A\u672C\u62A5\u9519\u201C^M: bad interpreter\u201D\u89E3\u51B3\u65B9\u6CD5 <a class="header-anchor" href="#_1\u3001sh\u811A\u672C\u62A5\u9519\u201C-m-bad-interpreter\u201D\u89E3\u51B3\u65B9\u6CD5" aria-hidden="true">#</a></h4><p>\u8FD9\u65F6\u56E0\u4E3A\u8FD9\u4E2Ash\u811A\u672C\u53EF\u80FD\u662F\u5728Windows\u7535\u8111\u4E0A\u5199\u7684\uFF0C\u6216\u662F\u5728Windows\u7535\u8111\u4E0A\u590D\u5236\u4E86\u4E00\u4E9B\u5185\u5BB9\u5230\u811A\u672C\u4E2D\uFF0C\u6216\u8FDB\u884C\u4E86\u4E00\u4E9B\u4E0D\u6B63\u786E\u7684\u64CD\u4F5C\uFF0C\u5FC5\u987B\u5C06\u811A\u672C\u683C\u5F0F\u7531dos\u6539\u4E3Aunix\u624D\u80FD\u89E3\u51B3\u95EE\u9898</p><p>\u7B2C\u4E00\u6B65\uFF1A\u9996\u5148\u5728Terminal\u4E2D\u8F93\u5165\u201Cvim \u811A\u672C\u201D\u547D\u4EE4\u3002 \u8FD9\u65F6\u4F1A\u770B\u5230\u6587\u4EF6\u6700\u4E0B\u65B9\u663E\u793A\u7684\u662F\u201C[dos]\u201D\uFF0C\u8FD9\u5C31\u8868\u793A\u8FD9\u4E2A\u811A\u672C\u662Fdos\u683C\u5F0F\u7684\u5566\u3002\u5982\u679C\u6CA1\u6709\u770B\u5230\uFF0C\u53EF\u4EE5\u8F93\u5165\u201C:set ff\u201D\uFF0C\u6309\u4E0BEnter\u952E\uFF0C\u67E5\u770B\u811A\u672C\u683C\u5F0F\u3002</p><p>\u7B2C\u4E8C\u6B65 \u8F93\u5165\u201C:set ff=unix\u201D\u540E\u6309Enter\uFF0C\u5C06\u683C\u5F0F\u66F4\u6539\u4E3Aunix\u683C\u5F0F\u3002 \u7136\u540E\u518D\u8F93\u5165\u201C:set ff\u201D\uFF0C\u6309\u4E0BEnter\u952E\uFF0C\u8FD9\u65F6\u5982\u679C\u770B\u5230\u201Cfileformat=unix\u201D\uFF0C\u8FD9\u8868\u660E\u683C\u5F0F\u4FEE\u6539\u6B63\u786E\u5566\u3002</p><p>\u7B2C\u4E09\u6B65 \u8F93\u5165\u201C:wq\u201D\uFF0C\u4FDD\u5B58\u5E76\u9000\u51FA\u811A\u672C\u3002 \u518D\u6B21\u8FD0\u884C\u811A\u672C\uFF0C\u770B\uFF0C\u4E0D\u518D\u51FA\u9519\u5566\u3002</p><p>\u6CE8\u610F\uFF0C\u7F16\u8F91sh\u811A\u672C\u524D\uFF0C\u4E00\u5B9A\u8981\u5C06\u8F93\u5165\u6CD5\u5207\u6362\u4E3A\u82F1\u6587\u534A\u89D2\u7B26\u53F7\u72B6\u6001\u3002</p>`,21),e=[o];function t(c,r,y,D,i,A){return n(),a("div",null,e)}var d=s(p,[["render",t]]);export{F as __pageData,d as default};
