import{_ as o,C as e,o as n,c,b as t,w as a,a3 as r,k as s,a as l,Q as E,H as y}from"./chunks/framework.26d96b30.js";const b=JSON.parse('{"title":"对外提供接口","description":"","frontmatter":{},"headers":[],"relativePath":"wso2/producer.md","filePath":"wso2/producer.md"}'),i={name:"wso2/producer.md"},d=s("h1",{id:"对外提供接口",tabindex:"-1"},[l("对外提供接口 "),s("a",{class:"header-anchor",href:"#对外提供接口","aria-label":'Permalink to "对外提供接口"'},"​")],-1),F=s("blockquote",null,[s("p",null,"第三方系统 通过 WSO2 请求 View API")],-1),A=E(`<h2 id="_1-创建接口" tabindex="-1">1.创建接口 <a class="header-anchor" href="#_1-创建接口" aria-label="Permalink to &quot;1.创建接口&quot;">​</a></h2><p>在 <code>web/sharp/modules/api/controllers</code> 目录下创建一个名为 <code>DemoController.php</code> 的文件，复制并粘贴以下内容。</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&lt;?</span><span style="color:#79B8FF;">php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">include_once</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">dirname</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">__FILE__</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/RestfulController.php&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Api_DemoController</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Api_RestfulController</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> $scope </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;Demo&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;">     * Demo</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">indexAction</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> ($_GET[</span><span style="color:#9ECBFF;">&#39;status&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;error&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;invalid phone number.&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">422</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">$this</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">success</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">            [</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;userId&#39;</span><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">888</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;nickName&#39;</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;Demo&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;phoneNumber&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;12345678910&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">            ],</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&#39;success&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        );</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&lt;?</span><span style="color:#005CC5;">php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">include_once</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">dirname</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">__FILE__</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/RestfulController.php&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Api_DemoController</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Api_RestfulController</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> $scope </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Demo&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;">     * Demo</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">indexAction</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> ($_GET[</span><span style="color:#032F62;">&#39;status&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;error&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">error</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;invalid phone number.&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">422</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">$this</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">success</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">            [</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;userId&#39;</span><span style="color:#24292E;">      </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">888</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;nickName&#39;</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Demo&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;phoneNumber&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;12345678910&#39;</span></span>
<span class="line"><span style="color:#24292E;">            ],</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&#39;success&#39;</span></span>
<span class="line"><span style="color:#24292E;">        );</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h2 id="_2-配置账号" tabindex="-1">2.配置账号 <a class="header-anchor" href="#_2-配置账号" aria-label="Permalink to &quot;2.配置账号&quot;">​</a></h2><p>在 <code>core</code> 目录下创建一个名为: <code>.restfulapi.authentication.ini</code> 的文件（文件名以&#39;.&#39;号开始），并复制粘贴以下内容。</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">;API账号信息</span></span>
<span class="line"><span style="color:#B392F0;">[API_DEMO]</span></span>
<span class="line"><span style="color:#F97583;">password</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#F97583;">scopes</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;Demo,Test&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">;API账号信息</span></span>
<span class="line"><span style="color:#6F42C1;">[API_DEMO]</span></span>
<span class="line"><span style="color:#D73A49;">password</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#D73A49;">scopes</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;Demo,Test&quot;</span></span></code></pre></div><ul><li>API_DEMO 将作为 <code>Basic Auth</code> 认证的账号</li><li>scopes 填写接口文件中的 <code>$scope</code> 变量，多个scope可以使用&quot;,&quot;号隔开</li></ul><h2 id="_3-接口调试" tabindex="-1">3.接口调试 <a class="header-anchor" href="#_3-接口调试" aria-label="Permalink to &quot;3.接口调试&quot;">​</a></h2><blockquote><p>本地开发不需要经过WSO2，可以直接进行测试</p></blockquote><p>接口地址: <code>http://hk.preview.test/sharp/api/demo</code></p><p>认证方式选择 <code>Basic Auth</code>，账号密码使用上面配置的信息</p>`,11);function u(h,C,B,_,D,f){const p=e("Mermaid");return n(),c("div",null,[d,F,(n(),t(r,null,{default:a(()=>[y(p,{id:"mermaid-8",class:"eita",graph:"flowchart%20LR%0AD%5B%5B%E7%AC%AC%E4%B8%89%E6%96%B9%E7%B3%BB%E7%BB%9FA%5D%5D%20%26%20E%5B%5B%E7%AC%AC%E4%B8%89%E6%96%B9%E7%B3%BB%E7%BB%9FB%5D%5D%20%26%20F%5B%5B%E7%AC%AC%E4%B8%89%E6%96%B9%E7%B3%BB%E7%BB%9FC%5D%5D%20---%3E%20C(%5BWSO2%5D)%20---%3E%20A(View)%20%26%20B(VFM)%0Astyle%20A%20fill%3A%237b1fa2%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20B%20fill%3A%234caf50%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20C%20fill%3A%23ff7300%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20D%20fill%3A%233a49ab%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20E%20fill%3A%233a49ab%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20F%20fill%3A%233a49ab%2Ccolor%3A%23fff%2Cstroke-width%3A0%0A"})]),fallback:a(()=>[l(" Loading... ")]),_:1})),A])}const k=o(i,[["render",u]]);export{b as __pageData,k as default};
