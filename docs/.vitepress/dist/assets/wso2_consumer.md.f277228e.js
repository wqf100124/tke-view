import{_ as o,C as e,o as a,c as t,b as c,w as n,a3 as r,k as s,a as l,Q as i,H as y}from"./chunks/framework.26d96b30.js";const E="/tke-view/image/screenshots/wso2/user/3.png",A="/tke-view/image/screenshots/wso2/user/4.png",u="/tke-view/image/screenshots/wso2/user/5.png",h="/tke-view/image/screenshots/wso2/user/6.png",d="/tke-view/image/screenshots/wso2/user/7.png",F="/tke-view/image/screenshots/wso2/user/8.png",_="/tke-view/image/screenshots/wso2/user/oauth-1.png",D="/tke-view/image/screenshots/wso2/user/oauth-2.png",C="/tke-view/image/screenshots/wso2/user/oauth-3.png",m="/tke-view/image/screenshots/wso2/user/subscribe-1.png",w="/tke-view/image/screenshots/wso2/user/subscribe-2.png",B="/tke-view/image/screenshots/wso2/user/14.png",g="/tke-view/image/screenshots/wso2/user/15.png",V=JSON.parse('{"title":"使用外部接口","description":"","frontmatter":{},"headers":[],"relativePath":"wso2/consumer.md","filePath":"wso2/consumer.md"}'),q={name:"wso2/consumer.md"},b=s("h1",{id:"使用外部接口",tabindex:"-1"},[l("使用外部接口 "),s("a",{class:"header-anchor",href:"#使用外部接口","aria-label":'Permalink to "使用外部接口"'},"​")],-1),I=s("blockquote",null,[s("p",null,"View 通过 WSO2 请求第三方系统 API")],-1),f=i('<h2 id="_1-创建api" tabindex="-1">1.创建Api <a class="header-anchor" href="#_1-创建api" aria-label="Permalink to &quot;1.创建Api&quot;">​</a></h2><p>打开 Api 管理页面并登录: <a href="https://localhost:9443/publisher" target="_blank" rel="noreferrer">https://localhost:9443/publisher</a><br> 账号: <code>admin</code><br> 密码: <code>admin</code></p><p>选择【REST API】类型的接口 <img src="'+E+'" alt=""></p><p>点击【Start From Scratch】 创建新的 API <img src="'+A+'" alt=""> 填入接口信息 <img src="'+u+'" alt=""></p><p>配置第三方接口的认证信息 <img src="'+h+'" alt=""></p><h2 id="_2-创建app" tabindex="-1">2.创建App <a class="header-anchor" href="#_2-创建app" aria-label="Permalink to &quot;2.创建App&quot;">​</a></h2><p>打开 App 管理页面: <a href="https://localhost:9443/devportal/applications" target="_blank" rel="noreferrer">https://localhost:9443/devportal/applications</a></p><p>点击【ADD NEW APPLICATION】按钮 <img src="'+d+'" alt=""> 填入信息并保存 <img src="'+F+'" alt=""></p><h2 id="_3-生成oauth认证密钥" tabindex="-1">3.生成OAuth认证密钥 <a class="header-anchor" href="#_3-生成oauth认证密钥" aria-label="Permalink to &quot;3.生成OAuth认证密钥&quot;">​</a></h2><p>切换到【Oauth2 Tokens】菜单栏 <img src="'+_+'" alt=""> 点击【GENERATE KEYS】生成新的认证密钥 <img src="'+D+'" alt=""> 查看新生成的密钥信息 <img src="'+C+'" alt=""></p><h2 id="_4-绑定api和app" tabindex="-1">4.绑定Api和App <a class="header-anchor" href="#_4-绑定api和app" aria-label="Permalink to &quot;4.绑定Api和App&quot;">​</a></h2><p>切换到【Subscriptions】菜单栏，然后点击页面上的【+SUBSCRIBE APIS】按钮 <img src="'+m+'" alt=""> 在弹出的页面中选择需要绑定的API，点击【SUBSCRIBE】按钮 <img src="'+w+`" alt=""></p><h2 id="_5-在view中使用" tabindex="-1">5.在View中使用 <a class="header-anchor" href="#_5-在view中使用" aria-label="Permalink to &quot;5.在View中使用&quot;">​</a></h2><h3 id="添加配置信息" tabindex="-1">添加配置信息 <a class="header-anchor" href="#添加配置信息" aria-label="Permalink to &quot;添加配置信息&quot;">​</a></h3><p>在项目的 <code>core</code> 文件夹下新建一个名为: <code>.restfulapi.authentication.ini</code> 的文件（文件名以&#39;.&#39;号开始），并复制粘贴以下内容。</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#6A737D;">;配置项名称</span></span>
<span class="line"><span style="color:#B392F0;">[APPLICATION_DEMO]</span></span>
<span class="line"><span style="color:#6A737D;">;WSO2的OAuth认证接口</span></span>
<span class="line"><span style="color:#F97583;">gatewayAuthUrl</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;https://172.16.1.94:9443/oauth2&quot;</span></span>
<span class="line highlighted"><span style="color:#6A737D;">;WSO2的Oauth帐号信息</span></span>
<span class="line highlighted"><span style="color:#F97583;">consumerKey</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;Gyf9T2mZRqiyC7z7kw8_g8ngxnoa&quot;</span></span>
<span class="line"><span style="color:#F97583;">consumerSecret</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;Xh6_eLPWaPBbUMfkUld72GG6JL4a&quot;</span></span>
<span class="line"><span style="color:#6A737D;">;WSO2中的API接口地址</span></span>
<span class="line"><span style="color:#F97583;">gatewayRecourceUrl</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;https://172.16.1.94:8243&quot;</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#6A737D;">;配置项名称</span></span>
<span class="line"><span style="color:#6F42C1;">[APPLICATION_DEMO]</span></span>
<span class="line"><span style="color:#6A737D;">;WSO2的OAuth认证接口</span></span>
<span class="line"><span style="color:#D73A49;">gatewayAuthUrl</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;https://172.16.1.94:9443/oauth2&quot;</span></span>
<span class="line highlighted"><span style="color:#6A737D;">;WSO2的Oauth帐号信息</span></span>
<span class="line highlighted"><span style="color:#D73A49;">consumerKey</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;Gyf9T2mZRqiyC7z7kw8_g8ngxnoa&quot;</span></span>
<span class="line"><span style="color:#D73A49;">consumerSecret</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;Xh6_eLPWaPBbUMfkUld72GG6JL4a&quot;</span></span>
<span class="line"><span style="color:#6A737D;">;WSO2中的API接口地址</span></span>
<span class="line"><span style="color:#D73A49;">gatewayRecourceUrl</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;https://172.16.1.94:8243&quot;</span></span></code></pre></div><ul><li>配置项名称对应 Application 的名称</li><li>consumerKey 对应 OAuth2 的 <code>Consumer Key</code> 和 <code>Consumer Secret</code></li></ul><h3 id="发送请求" tabindex="-1">发送请求 <a class="header-anchor" href="#发送请求" aria-label="Permalink to &quot;发送请求&quot;">​</a></h3><p>在项目中新建一个 <code>web/wso2.php</code> 的测试文件，并复制粘贴以下代码。</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&lt;?</span><span style="color:#79B8FF;">php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">NO_USER_REQUIRED</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">NO_PERMISSION_REQUIRED</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">require_once</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;{</span><span style="color:#E1E4E8;">$_SERVER</span><span style="color:#9ECBFF;">[&#39;DOCUMENT_ROOT&#39;]}/../sys/libs/init.lib&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">require_once</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;{</span><span style="color:#E1E4E8;">$_SERVER</span><span style="color:#9ECBFF;">[&#39;DOCUMENT_ROOT&#39;]}/../sys/libs/logic/Util/Gateway/ViewGateway.lib&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">VIEW\\Util\\Gateway\\ViewGateway</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// .ini文件中的配置项名称</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">CONFIG_NAME</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;APPLICATION_DEMO&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;">// API名称</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">API_NAME</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;Demo&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;">// API路径(context)</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">API_URI</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/demo&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;">// API版本</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">API_VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;1.0&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    $viewGateway </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ViewGateway</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">CONFIG_NAME</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 发送请求</span></span>
<span class="line"><span style="color:#E1E4E8;">    $result </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> $viewGateway</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">post</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">API_NAME</span><span style="color:#E1E4E8;">, [], </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">API_VERSION</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">API_URI</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">empty</span><span style="color:#E1E4E8;">($result)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 接口请求失败，记录日志</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">} </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">Exception</span><span style="color:#E1E4E8;"> $e) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">var_dump</span><span style="color:#E1E4E8;">($e);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&lt;?</span><span style="color:#005CC5;">php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">NO_USER_REQUIRED</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">NO_PERMISSION_REQUIRED</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">require_once</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;{</span><span style="color:#24292E;">$_SERVER</span><span style="color:#032F62;">[&#39;DOCUMENT_ROOT&#39;]}/../sys/libs/init.lib&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">require_once</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;{</span><span style="color:#24292E;">$_SERVER</span><span style="color:#032F62;">[&#39;DOCUMENT_ROOT&#39;]}/../sys/libs/logic/Util/Gateway/ViewGateway.lib&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">use</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">VIEW\\Util\\Gateway\\ViewGateway</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// .ini文件中的配置项名称</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">CONFIG_NAME</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;APPLICATION_DEMO&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;">// API名称</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">API_NAME</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Demo&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;">// API路径(context)</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">API_URI</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/demo&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;">// API版本</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">API_VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;1.0&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    $viewGateway </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ViewGateway</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">CONFIG_NAME</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 发送请求</span></span>
<span class="line"><span style="color:#24292E;">    $result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> $viewGateway</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">post</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">API_NAME</span><span style="color:#24292E;">, [], </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">API_VERSION</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">API_URI</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">empty</span><span style="color:#24292E;">($result)) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 接口请求失败，记录日志</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">} </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">Exception</span><span style="color:#24292E;"> $e) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">var_dump</span><span style="color:#24292E;">($e);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h3 id="处理响应" tabindex="-1">处理响应 <a class="header-anchor" href="#处理响应" aria-label="Permalink to &quot;处理响应&quot;">​</a></h3><p>创建处理文件: <code>sys/libs/logic/Util/Gateway/Handler/DemoGatewayBizHandler.php</code></p><p><em>文件命名规范：&lt;App名称&gt;GatewayBizHandler.php</em></p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&lt;?</span><span style="color:#79B8FF;">php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VIEW\\Util\\Gateway\\Handler</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">require_once</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;{</span><span style="color:#E1E4E8;">$_SERVER</span><span style="color:#9ECBFF;">[&#39;DOCUMENT_ROOT&#39;]}/../sys/libs/curl_api_adapter/curl.lib&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">require_once</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;{</span><span style="color:#E1E4E8;">$_SERVER</span><span style="color:#9ECBFF;">[&#39;DOCUMENT_ROOT&#39;]}/../sys/libs/view_exceptions/autoloader.php&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">require_once</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">SYSTEM_DIR</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/libs/logic/external_access_logger/bo/ExternalAccessLogger.lib&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">require_once</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SYSTEM_DIR</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/libs/jwt_wrapper/autoloader.php&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">VIEW\\Util\\Gateway\\ViewGatewayBizHandlerBaseService</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DemoGatewayBizHandler</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ViewGatewayBizHandlerBaseService</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;">     * Demo</span></span>
<span class="line"><span style="color:#6A737D;">     *</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#F97583;">@param</span><span style="color:#6A737D;"> $applicationName</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#F97583;">@param</span><span style="color:#6A737D;"> $apiName</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#F97583;">@param</span><span style="color:#6A737D;"> $requestMethod</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#F97583;">@param</span><span style="color:#6A737D;"> $requestData</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#F97583;">@param</span><span style="color:#6A737D;"> $version</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#F97583;">@param</span><span style="color:#6A737D;"> $retutrnValue</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#F97583;">@param</span><span style="color:#6A737D;"> $identifier</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">onFinish</span><span style="color:#E1E4E8;">($applicationName, $apiName, $requestMethod, $requestData, $version, $retutrnValue, $identifier)</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">var_dump</span><span style="color:#E1E4E8;">($retutrnValue);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">parent::</span><span style="color:#B392F0;">onFinish</span><span style="color:#E1E4E8;">($applicationName, $apiName, $requestMethod, $requestData, $version, $retutrnValue, $identifier);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&lt;?</span><span style="color:#005CC5;">php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">namespace</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VIEW\\Util\\Gateway\\Handler</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">require_once</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;{</span><span style="color:#24292E;">$_SERVER</span><span style="color:#032F62;">[&#39;DOCUMENT_ROOT&#39;]}/../sys/libs/curl_api_adapter/curl.lib&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">require_once</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;{</span><span style="color:#24292E;">$_SERVER</span><span style="color:#032F62;">[&#39;DOCUMENT_ROOT&#39;]}/../sys/libs/view_exceptions/autoloader.php&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">require_once</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">SYSTEM_DIR</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/libs/logic/external_access_logger/bo/ExternalAccessLogger.lib&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">require_once</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SYSTEM_DIR</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/libs/jwt_wrapper/autoloader.php&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">use</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">VIEW\\Util\\Gateway\\ViewGatewayBizHandlerBaseService</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DemoGatewayBizHandler</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ViewGatewayBizHandlerBaseService</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;">     * Demo</span></span>
<span class="line"><span style="color:#6A737D;">     *</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> $applicationName</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> $apiName</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> $requestMethod</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> $requestData</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> $version</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> $retutrnValue</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> $identifier</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">onFinish</span><span style="color:#24292E;">($applicationName, $apiName, $requestMethod, $requestData, $version, $retutrnValue, $identifier)</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">var_dump</span><span style="color:#24292E;">($retutrnValue);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">parent::</span><span style="color:#6F42C1;">onFinish</span><span style="color:#24292E;">($applicationName, $apiName, $requestMethod, $requestData, $version, $retutrnValue, $identifier);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h2 id="_6-接口调试" tabindex="-1">6.接口调试 <a class="header-anchor" href="#_6-接口调试" aria-label="Permalink to &quot;6.接口调试&quot;">​</a></h2><h3 id="获取accesstoken" tabindex="-1">获取AccessToken <a class="header-anchor" href="#获取accesstoken" aria-label="Permalink to &quot;获取AccessToken&quot;">​</a></h3><p>1.打开调试工具，使用 <code>POST</code> 方法请求URL: <code>https://localhost:9443/oauth2/token</code><br> 2.认证方式选择 <code>Basic Auth</code>，账号密码填写 OAuth2 的 <code>Key</code> 和 <code>Secret</code><img src="`+B+'" alt=""> 在请求的 <code>Body</code> 中添加 <code>grant_type:client_credentials</code> 信息 <img src="'+g+'" alt=""></p><h3 id="请求api-wso2直连" tabindex="-1">请求API(WSO2直连) <a class="header-anchor" href="#请求api-wso2直连" aria-label="Permalink to &quot;请求API(WSO2直连)&quot;">​</a></h3><p>1.打开调试工具，使用 <code>POST</code> 方法请求URL: <code>https://localhost:8243/demo/1.0</code><br> 2.认证方式选择 <code>Bearer Token</code>，Token内容使用上面获取的 <code>access_token</code></p><h3 id="请求api-view中使用wso2" tabindex="-1">请求API(View中使用WSO2) <a class="header-anchor" href="#请求api-view中使用wso2" aria-label="Permalink to &quot;请求API(View中使用WSO2)&quot;">​</a></h3><p>访问你的URL如: <code>https://localhost:8243/wso2.php</code></p>',31);function O($,k,P,S,R,v){const p=e("Mermaid");return a(),t("div",null,[b,I,(a(),c(r,null,{default:n(()=>[y(p,{id:"mermaid-8",class:"eita",graph:"flowchart%20LR%0AA(View)%20%26%20B(VFM)%20---%3E%20C(%5BWSO2%5D)%20---%3E%20D%5B%5B%E7%AC%AC%E4%B8%89%E6%96%B9%E7%B3%BB%E7%BB%9FA%5D%5D%20%26%20E%5B%5B%E7%AC%AC%E4%B8%89%E6%96%B9%E7%B3%BB%E7%BB%9FB%5D%5D%20%26%20F%5B%5B%E7%AC%AC%E4%B8%89%E6%96%B9%E7%B3%BB%E7%BB%9FC%5D%5D%0Astyle%20A%20fill%3A%237b1fa2%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20B%20fill%3A%234caf50%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20C%20fill%3A%23ff7300%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20D%20fill%3A%233a49ab%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20E%20fill%3A%233a49ab%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20F%20fill%3A%233a49ab%2Ccolor%3A%23fff%2Cstroke-width%3A0%0A"})]),fallback:n(()=>[l(" Loading... ")]),_:1})),f])}const T=o(q,[["render",O]]);export{V as __pageData,T as default};
