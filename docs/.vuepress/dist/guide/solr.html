<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.38">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Solr环境 | ViewDocs</title><meta name="description" content="基于Docker搭建的View系统本地开发环境">
    <link rel="modulepreload" href="/tke-view/assets/app.52f58217.js"><link rel="modulepreload" href="/tke-view/assets/solr.html.07e851b4.js"><link rel="modulepreload" href="/tke-view/assets/solr.html.57c66613.js">
    <link rel="stylesheet" href="/tke-view/assets/style.b684203e.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/tke-view/" class=""><!----><span class="site-name">ViewDocs</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://hub.docker.com/r/rtwadewang/tke" rel="noopener noreferrer" target="_blank" aria-label="Docker镜像"><!--[--><!--]--> Docker镜像 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/wqf100124/tke-view" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://hub.docker.com/r/rtwadewang/tke" rel="noopener noreferrer" target="_blank" aria-label="Docker镜像"><!--[--><!--]--> Docker镜像 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/wqf100124/tke-view" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active"> <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/tke-view/guide/view.html" class="sidebar-item" aria-label="View本地开发环境"><!--[--><!--]--> View本地开发环境 <!--[--><!--]--></a><!----></li><li><a href="/tke-view/guide/autotest.html" class="sidebar-item" aria-label="Autotest自动化测试环境"><!--[--><!--]--> Autotest自动化测试环境 <!--[--><!--]--></a><!----></li><li><a href="/tke-view/guide/rabbitmq.html" class="sidebar-item" aria-label="RabbitMQ环境"><!--[--><!--]--> RabbitMQ环境 <!--[--><!--]--></a><!----></li><li><a href="/tke-view/guide/wso2.html" class="sidebar-item" aria-label="WSO2环境"><!--[--><!--]--> WSO2环境 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/tke-view/guide/solr.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Solr环境"><!--[--><!--]--> Solr环境 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/tke-view/guide/solr.html#solr-介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="Solr 介绍"><!--[--><!--]--> Solr 介绍 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/tke-view/guide/solr.html#搭建环境" class="router-link-active router-link-exact-active sidebar-item" aria-label="搭建环境"><!--[--><!--]--> 搭建环境 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/tke-view/guide/solr.html#_1-创建solr服务容器" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.创建solr服务容器"><!--[--><!--]--> 1.创建solr服务容器 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/tke-view/guide/solr.html#在view中使用" class="router-link-active router-link-exact-active sidebar-item" aria-label="在View中使用"><!--[--><!--]--> 在View中使用 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/tke-view/guide/solr.html#_1-配置数据源" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.配置数据源"><!--[--><!--]--> 1.配置数据源 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/tke-view/guide/solr.html#_2-配置bo文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.配置Bo文件"><!--[--><!--]--> 2.配置Bo文件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/tke-view/guide/solr.html#_3-使用集合" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.使用集合"><!--[--><!--]--> 3.使用集合 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/tke-view/guide/solr.html#部署" class="router-link-active router-link-exact-active sidebar-item" aria-label="部署"><!--[--><!--]--> 部署 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="solr环境" tabindex="-1"><a class="header-anchor" href="#solr环境" aria-hidden="true">#</a> Solr环境</h1><h2 id="solr-介绍" tabindex="-1"><a class="header-anchor" href="#solr-介绍" aria-hidden="true">#</a> Solr 介绍</h2><p>什么是 Solr？<br> Solr 采用 Java5 开发，是建立在 Apache Lucene™上的流行的、快速的开源企业搜索平台。<br> Solr 具有高度可靠、可伸缩和容错能力，提供分布式索引、复制和负载平衡查询、自动故障转移和恢复、集中配置等功能。<br> Solr 为世界上许多最大的互联网站点的搜索和导航功能提供了动力。</p><h2 id="搭建环境" tabindex="-1"><a class="header-anchor" href="#搭建环境" aria-hidden="true">#</a> 搭建环境</h2><h3 id="_1-创建solr服务容器" tabindex="-1"><a class="header-anchor" href="#_1-创建solr服务容器" aria-hidden="true">#</a> 1.创建solr服务容器</h3><p>官方镜像: <a href="https://hub.docker.com/_/solr" target="_blank" rel="noopener noreferrer">https://hub.docker.com/_/solr<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">docker</span> run -d --name solr --network tke --ip <span class="token number">172.16</span>.1.89 -p <span class="token number">8983</span>:8983 solr solr-precreate view
</code></pre></div><p>Solr管理控制台: <a href="http://localhost:8983/" target="_blank" rel="noopener noreferrer">http://localhost:8983/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="在view中使用" tabindex="-1"><a class="header-anchor" href="#在view中使用" aria-hidden="true">#</a> 在View中使用</h2><h3 id="_1-配置数据源" tabindex="-1"><a class="header-anchor" href="#_1-配置数据源" aria-hidden="true">#</a> 1.配置数据源</h3><p>在目录<code>/core/sys/libs/SearchEngine/schema/solr</code>中创建项目目录，同时在该目录中创建<code>scope.properties</code>、<code>managed-schema.tmpl.xml</code>、<code>db-data-config.tmpl.xml</code>3个文件</p><p>示例: <img src="/tke-view/assets/2.2cc1741f.png" alt=""></p><h4 id="db-data-config-tmpl-xml" tabindex="-1"><a class="header-anchor" href="#db-data-config-tmpl-xml" aria-hidden="true">#</a> db-data-config.tmpl.xml</h4><p>该文件用于配置集合的数据源和字段。</p><ul><li><code>Query</code>中的<code>sql</code>是集合的数据源，<code>pk</code>是集合的主键。</li><li><code>Deltaquery</code>和<code>deltaImportQuery</code>用来批量更新集合。</li><li><code>Field</code>用来定义集合字段名称。</li></ul><blockquote><p>脚本<code>/core/sys/bin/RebuildSolrCollections.php</code>会在每天的23:00去批量更新集合数据的<code>deltaQuery</code>和<code>deltaImportQuery</code>。<code>deltaQuery</code>会搜索需要更新的数据，<code>deltaImportQuery</code>会将搜索结果更新到集合中。</p></blockquote><p>文件示例:</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataConfig</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>document</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entity</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unit<span class="token punctuation">&quot;</span></span> 
            <span class="token attr-name">query</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SELECT  u.id, 
                    CONCAT_WS(<span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>,GROUP_CONCAT(DISTINCT b.Premises_en SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>), GROUP_CONCAT(DISTINCT b.Premises_local SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>), GROUP_CONCAT(DISTINCT b.Address_val SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT b.BuildingNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),
                    GROUP_CONCAT(DISTINCT u.UnitNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT u.LiftNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT k.StreetAddress_en SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),
                    GROUP_CONCAT(DISTINCT StreetAddress_local SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT k.Name_val SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT u.RegisteredNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>)) as BuildingName,
                    CONCAT_WS(<span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>,GROUP_CONCAT(DISTINCT b.Premises_en SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>), GROUP_CONCAT(DISTINCT b.Premises_local SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>), GROUP_CONCAT(DISTINCT b.Address_val SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>)) as PremisesName,
                    CONCAT_WS(<span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>,GROUP_CONCAT(DISTINCT br.Code_en SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT br.Code_local SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT o.Name_en SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT o.Name_local SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>)) as Branches,
                    CONCAT_WS(<span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>,GROUP_CONCAT(DISTINCT b.City_val SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT b.Suburb_val SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT k.City_en SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT k.City_local SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),
                    GROUP_CONCAT(DISTINCT k.Suburb_en SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT k.Suburb_local SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>)) as CitySuburb,
                    CONCAT_WS(<span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>,GROUP_CONCAT(DISTINCT b.Postcode_val SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT k.Postcode_val SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>)) as Postcode,
                    CONCAT_WS(<span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>, GROUP_CONCAT(DISTINCT u.UnitNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT u.LiftNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>)) as UnitNumber,
                    GROUP_CONCAT(DISTINCT u.LiftNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>) as UnitliftNumber,
                    GROUP_CONCAT(DISTINCT ci.ContractNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>) as ContractNumber,
                    GROUP_CONCAT(DISTINCT u.BranchID SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>) as BranchId
                    FROM unit u
                    JOIN bank k ON k.id = u.BankID
                    JOIN building b ON b.id = k.BuildingID
                    LEFT JOIN office o ON u.OfficeID = o.id
                    LEFT JOIN branch br ON u.BranchID = br.id
                    LEFT JOIN contract_unit cui ON cui.UnitID = u.id
                    LEFT JOIN contract ci ON ci.id = cui.ContractID
                    WHERE u.InService = 1
                    GROUP BY u.id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">deltaQuery</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SELECT id FROM unit WHERE  DATE_ADD(LastModified, INTERVAL 12 HOUR) &gt;
                            if(<span class="token punctuation">&#39;</span>${dataimporter.request.customize_startdate}<span class="token punctuation">&#39;</span> != <span class="token punctuation">&#39;</span><span class="token punctuation">&#39;</span>, <span class="token punctuation">&#39;</span>${dataimporter.request.customize_startdate}<span class="token punctuation">&#39;</span>, <span class="token punctuation">&#39;</span>${dataimporter.last_index_time}<span class="token punctuation">&#39;</span>)<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">deletedPkQuery</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SELECT id FROM unit WHERE InService = 0 AND DATE_ADD(LastModified, INTERVAL 12 HOUR) &gt;
                            if(<span class="token punctuation">&#39;</span>${dataimporter.request.customize_startdate}<span class="token punctuation">&#39;</span> != <span class="token punctuation">&#39;</span><span class="token punctuation">&#39;</span>, <span class="token punctuation">&#39;</span>${dataimporter.request.customize_startdate}<span class="token punctuation">&#39;</span>, <span class="token punctuation">&#39;</span>${dataimporter.last_index_time}<span class="token punctuation">&#39;</span>)<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">deltaImportQuery</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SELECT  u.id, 
                    CONCAT_WS(<span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>,GROUP_CONCAT(DISTINCT b.Premises_en SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>), GROUP_CONCAT(DISTINCT b.Premises_local SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>), GROUP_CONCAT(DISTINCT b.Address_val SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT b.BuildingNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),
                    GROUP_CONCAT(DISTINCT u.UnitNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT u.LiftNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT k.StreetAddress_en SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),
                    GROUP_CONCAT(DISTINCT StreetAddress_local SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT k.Name_val SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT u.RegisteredNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>)) as BuildingName,
                    CONCAT_WS(<span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>,GROUP_CONCAT(DISTINCT b.Premises_en SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>), GROUP_CONCAT(DISTINCT b.Premises_local SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>), GROUP_CONCAT(DISTINCT b.Address_val SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>)) as PremisesName,
                    CONCAT_WS(<span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>,GROUP_CONCAT(DISTINCT br.Code_en SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT br.Code_local SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT o.Name_en SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT o.Name_local SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>)) as Branches,
                    CONCAT_WS(<span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>,GROUP_CONCAT(DISTINCT b.City_val SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT b.Suburb_val SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT k.City_en SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT k.City_local SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),
                    GROUP_CONCAT(DISTINCT k.Suburb_en SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT k.Suburb_local SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>)) as CitySuburb,
                    CONCAT_WS(<span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>,GROUP_CONCAT(DISTINCT b.Postcode_val SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT k.Postcode_val SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>)) as Postcode,
                    CONCAT_WS(<span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>, GROUP_CONCAT(DISTINCT u.UnitNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>),GROUP_CONCAT(DISTINCT u.LiftNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>)) as UnitNumber,
                    GROUP_CONCAT(DISTINCT u.LiftNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>) as UnitliftNumber,
                    GROUP_CONCAT(DISTINCT ci.ContractNumber SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>) as ContractNumber,
                    GROUP_CONCAT(DISTINCT u.BranchID SEPARATOR <span class="token punctuation">&#39;</span>|<span class="token punctuation">&#39;</span>) as BranchId
                    FROM unit u
                    JOIN bank k ON k.id = u.BankID
                    JOIN building b ON b.id = k.BuildingID
                    LEFT JOIN office o ON u.OfficeID = o.id
                    LEFT JOIN branch br ON u.BranchID = br.id
                    LEFT JOIN contract_unit cui ON cui.UnitID = u.id
                    LEFT JOIN contract ci ON ci.id = cui.ContractID
                    WHERE u.id = <span class="token punctuation">&#39;</span>${dataimporter.delta.id}<span class="token punctuation">&#39;</span>
                    GROUP BY u.id<span class="token punctuation">&quot;</span></span>
                   <span class="token attr-name">transformer</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>RegexTransformer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BuildingName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>buildingName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">splitBy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\|<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PremisesName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>premisesName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">splitBy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\|<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Branches<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>branches<span class="token punctuation">&quot;</span></span> <span class="token attr-name">splitBy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\|<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CitySuburb<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>citySuburb<span class="token punctuation">&quot;</span></span> <span class="token attr-name">splitBy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\|<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Postcode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>postcode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">splitBy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\|<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UnitNumber<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unitNumber<span class="token punctuation">&quot;</span></span> <span class="token attr-name">splitBy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\|<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UnitliftNumber<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unitliftNumber<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ContractNumber<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>contractNumber<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BranchId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>branchId<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entity</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>document</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataConfig</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><h4 id="managed-schema-tmpl-xml" tabindex="-1"><a class="header-anchor" href="#managed-schema-tmpl-xml" aria-hidden="true">#</a> managed-schema.tmpl.xml</h4><p>该文件用于配置集合的属性，其中的<code>field</code>字段应该和<code>db-data-config.tmpl.xml</code>文件中的字段保持一致</p><p><em>字段配置参数说明</em></p><table><thead><tr><th>属性</th><th>是否必填</th><th>描述</th></tr></thead><tbody><tr><td>name</td><td>是</td><td>字段名称</td></tr><tr><td>type</td><td>是</td><td>字段类型</td></tr><tr><td>indexed</td><td>是</td><td>是否建立索引（可搜索和排序）</td></tr><tr><td>stored</td><td>是</td><td>是否应该检索该字段</td></tr><tr><td>required</td><td>否</td><td>该字段是否为必需的。如果该值不存在，将抛出错误</td></tr><tr><td>multivalued</td><td>否</td><td>该字段是否可能包含多个值</td></tr></tbody></table><p>文件示例:</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>example-DIH-db<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.6<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>string<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">required</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>buildingName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>string_lower<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">multiValued</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>premisesName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>string_lower<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">multiValued</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unitNumber<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>string_lower<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">multiValued</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unitliftNumber<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>string_lower<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>contractNumber<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>string_lower<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>branches<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>string_lower<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">multiValued</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>citySuburb<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>string_lower<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">multiValued</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>postcode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>string<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">multiValued</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>branchId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>string<span class="token punctuation">&quot;</span></span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="scope-properties" tabindex="-1"><a class="header-anchor" href="#scope-properties" aria-hidden="true">#</a> scope.properties</h4><p>该文件用于配置多语言字段。</p><p>如果<code>nameEn</code>和<code>nameLocal</code>是多语言字段，配置内容为: <code>multilingual.fields=nameEn,nameLocal</code></p><p>文件示例:</p><div class="language-ini ext-ini"><pre class="language-ini"><code><span class="token comment">; indicate the scope of current concept, country/global</span>
<span class="token key attr-name">concept.scope</span><span class="token punctuation">=</span><span class="token value attr-value">country</span>

<span class="token comment">; multiple languages other than English</span>
<span class="token comment">; multilingual.fields=PremisesLocal</span>
</code></pre></div><h3 id="_2-配置bo文件" tabindex="-1"><a class="header-anchor" href="#_2-配置bo文件" aria-hidden="true">#</a> 2.配置Bo文件</h3><p>在<code>/core/sys/libs/SearchEngine/Collections.xml</code>文件的<code>collections</code>中添加新的<code>collection</code></p><p>collection配置参数说明:</p><table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td>name</td><td>集合名称</td></tr><tr><td>category</td><td>使用范围</td></tr><tr><td>registedPlainObjectClassName</td><td>关联的BO文件的类名</td></tr><tr><td>registedPlainObjectClassPath</td><td>关联的BO文件路径，文件路径默认为<code>/web</code>。例如：文件路径是<code>/core/sys/libs/logic/Unit/Bo/Unit.php</code>， 则配置路径应为<code>/../sys/libs/logic/Unit/Bo/Unit.php</code>。</td></tr></tbody></table><p>field配置参数说明:</p><table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td>name</td><td>字段名称</td></tr><tr><td>key</td><td>是否主键</td></tr><tr><td>plainMapping</td><td>Bo文件对应的属性，必须包含get和set方法</td></tr></tbody></table><p><code>Queries</code>包括一个或多个<code>query</code>，每个<code>query</code>表示搜索集合</p><p>Collections.xml文件示例:</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collections</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">category</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>country<span class="token punctuation">&quot;</span></span> <span class="token attr-name">registedPlainObjectClassName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Unit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">registedPlainObjectClassPath</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/../sys/libs/logic/Unit/Bo/Unit.php<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fields</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>yes<span class="token punctuation">&quot;</span></span> <span class="token attr-name">plainMapping</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unitId<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>firstName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">plainMapping</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>firstName<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lastName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">plainMapping</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lastName<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>phoneNumber<span class="token punctuation">&quot;</span></span> <span class="token attr-name">plainMapping</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>phoneNumber<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">plainMapping</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cellPhone<span class="token punctuation">&quot;</span></span> <span class="token attr-name">plainMapping</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cellPhone<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uniqueEmail<span class="token punctuation">&quot;</span></span> <span class="token attr-name">plainMapping</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uniqueEmail<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fields</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>queries</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>query</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>searchByUnitFields<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>basicQuery</span> <span class="token attr-name">logicalOperator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>or<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parameter</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>variableName</span><span class="token punctuation">&gt;</span></span>phoneNumber<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>variableName</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appliedFields</span><span class="token punctuation">&gt;</span></span>phoneNumber<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appliedFields</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phrase</span><span class="token punctuation">&gt;</span></span>no<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phrase</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parameter</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parameter</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>variableName</span><span class="token punctuation">&gt;</span></span>email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>variableName</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appliedFields</span><span class="token punctuation">&gt;</span></span>email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appliedFields</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phrase</span><span class="token punctuation">&gt;</span></span>no<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phrase</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parameter</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>basicQuery</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parameter</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>variableName</span><span class="token punctuation">&gt;</span></span>firstName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>variableName</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appliedFields</span><span class="token punctuation">&gt;</span></span>firstName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appliedFields</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phrase</span><span class="token punctuation">&gt;</span></span>no<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phrase</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parameter</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parameter</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>variableName</span><span class="token punctuation">&gt;</span></span>lastName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>variableName</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appliedFields</span><span class="token punctuation">&gt;</span></span>lastName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appliedFields</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phrase</span><span class="token punctuation">&gt;</span></span>no<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phrase</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parameter</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>response</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>responseFields</span><span class="token punctuation">&gt;</span></span>id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>responseFields</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>highlightedFields</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>highlightedFields</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rows</span><span class="token punctuation">&gt;</span></span>999<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rows</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>response</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>query</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>queries</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collections</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p>Bo文件示例:</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">VIEW<span class="token punctuation">\</span>Unit<span class="token punctuation">\</span>Bo</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Class
 * Unit BO
 */</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Unit</span> <span class="token keyword">extends</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>ViewBaseBO</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Database field</span>
    <span class="token keyword">protected</span> <span class="token variable">$unitId</span>                    <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$externalId</span>                   <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$title</span>                        <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$firstName</span>                    <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$lastName</span>                     <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$location</span>                     <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * Solr : Set unitId
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token keyword">int</span></span> <span class="token parameter">$unitId</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">setUnitId</span><span class="token punctuation">(</span><span class="token variable">$unitId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">unitId</span> <span class="token operator">=</span> <span class="token variable">$unitId</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token doc-comment comment">/**
     * Solr : Get unitId
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">int</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getUnitId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">unitId</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_3-使用集合" tabindex="-1"><a class="header-anchor" href="#_3-使用集合" aria-hidden="true">#</a> 3.使用集合</h3><p>代码示例:</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">VIEW<span class="token punctuation">\</span>Unit<span class="token punctuation">\</span>Service</span><span class="token punctuation">;</span>

<span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;DOCUMENT_ROOT&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>/../sys/libs/SearchEngine/CollectionSearchEngine.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">UnitService</span> <span class="token keyword">extends</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>ViewBaseService</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// country环境实例</span>
        <span class="token variable">$collection</span> <span class="token operator">=</span> <span class="token class-name static-context">CollectionSearchEngine</span><span class="token operator">::</span><span class="token function">getNativeInstance</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;unit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// global环境实例，仅可在国家环境下使用</span>
        <span class="token variable">$collection</span> <span class="token operator">=</span> <span class="token class-name static-context">CollectionSearchEngine</span><span class="token operator">::</span><span class="token function">getGlobalInstance</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;unit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// country环境实例，仅可在global下使用，第二个参数为siteId</span>
        <span class="token variable">$collection</span> <span class="token operator">=</span> <span class="token class-name static-context">CollectionSearchEngine</span><span class="token operator">::</span><span class="token function">getExternalCountryInstance</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;unit&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 条件查询</span>
        <span class="token variable">$condition</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">&#39;name&#39;</span>     <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;test&#39;</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;branchId&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">104</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;searchByUnitFields&#39;</span><span class="token punctuation">,</span> <span class="token variable">$condition</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// 更新集合</span>
        <span class="token variable">$unit</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UnitBo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$unit</span><span class="token operator">-&gt;</span><span class="token function">setUnitId</span><span class="token punctuation">(</span><span class="token number">888888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$unit</span><span class="token operator">-&gt;</span><span class="token function">setFirstName</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;first name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$unit</span><span class="token operator">-&gt;</span><span class="token function">setLastName</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;last name&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$unit</span><span class="token operator">-&gt;</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;test@gmail.com&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$unit</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// 从集合中删除</span>
        <span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token variable">$unitId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h2 id="部署" tabindex="-1"><a class="header-anchor" href="#部署" aria-hidden="true">#</a> 部署</h2><p>在配置文件提交svn部署完之后,确认没有问题找运维用脚本创建. (Dev找mason, 其他环境找Mars).</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/tke-view/guide/wso2.html" class="" aria-label="WSO2环境"><!--[--><!--]--> WSO2环境 <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/tke-view/assets/app.52f58217.js" defer></script>
  </body>
</html>
