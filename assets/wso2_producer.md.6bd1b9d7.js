import{_ as n,o as l,c as o,C as p,x as s,a as e,Q as t,D as c}from"./chunks/framework.db0ccc71.js";const E=JSON.parse('{"title":"对外提供接口","description":"","frontmatter":{},"headers":[],"relativePath":"wso2/producer.md"}'),r={name:"wso2/producer.md"},D=s("h1",{id:"对外提供接口",tabindex:"-1"},[e("对外提供接口 "),s("a",{class:"header-anchor",href:"#对外提供接口","aria-label":'Permalink to "对外提供接口"'},"​")],-1),y=s("blockquote",null,[s("p",null,"第三方系统 通过 WSO2 请求 View API")],-1),F=t(`<h2 id="_1-创建接口" tabindex="-1">1.创建接口 <a class="header-anchor" href="#_1-创建接口" aria-label="Permalink to &quot;1.创建接口&quot;">​</a></h2><p>在 <code>web/sharp/modules/api/controllers</code> 目录下创建一个名为 <code>DemoController.php</code> 的文件，复制并粘贴以下内容。</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;?</span><span style="color:#A6ACCD;">php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">include_once</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">dirname</span><span style="color:#89DDFF;">(__FILE__)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/RestfulController.php</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Api_DemoController</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Api_RestfulController</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">scope </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Demo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * Demo</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">indexAction</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">_GET</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">status</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$this-&gt;</span><span style="color:#82AAFF;">error</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">invalid phone number.</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">422</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$this-&gt;</span><span style="color:#82AAFF;">success</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">userId</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">888</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">nickName</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Demo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">phoneNumber</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">12345678910</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">success</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="_2-配置账号" tabindex="-1">2.配置账号 <a class="header-anchor" href="#_2-配置账号" aria-label="Permalink to &quot;2.配置账号&quot;">​</a></h2><p>在 <code>core</code> 目录下创建一个名为: <code>.restfulapi.authentication.ini</code> 的文件（文件名以&#39;.&#39;号开始），并复制粘贴以下内容。</p><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">;API账号信息</span></span>
<span class="line"><span style="color:#89DDFF;">[API_DEMO]</span></span>
<span class="line"><span style="color:#F07178;">password</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">123456</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">scopes</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Demo,Test</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><ul><li>API_DEMO 将作为 <code>Basic Auth</code> 认证的账号</li><li>scopes 填写接口文件中的 <code>$scope</code> 变量，多个scope可以使用&quot;,&quot;号隔开</li></ul><h2 id="_3-接口调试" tabindex="-1">3.接口调试 <a class="header-anchor" href="#_3-接口调试" aria-label="Permalink to &quot;3.接口调试&quot;">​</a></h2><blockquote><p>本地开发不需要经过WSO2，可以直接进行测试</p></blockquote><p>接口地址: <code>http://hk.preview.test/sharp/api/demo</code></p><p>认证方式选择 <code>Basic Auth</code>，账号密码使用上面配置的信息</p>`,11);function A(i,C,d,h,f,u){const a=c("Mermaid");return l(),o("div",null,[D,y,p(a,{id:"mermaid_1a962852",graph:"flowchart%20LR%0AD%5B%5B%E7%AC%AC%E4%B8%89%E6%96%B9%E7%B3%BB%E7%BB%9FA%5D%5D%20%26%20E%5B%5B%E7%AC%AC%E4%B8%89%E6%96%B9%E7%B3%BB%E7%BB%9FB%5D%5D%20%26%20F%5B%5B%E7%AC%AC%E4%B8%89%E6%96%B9%E7%B3%BB%E7%BB%9FC%5D%5D%20---%3E%20C(%5BWSO2%5D)%20---%3E%20A(View)%20%26%20B(VFM)%0Astyle%20A%20fill%3A%237b1fa2%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20B%20fill%3A%234caf50%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20C%20fill%3A%23ff7300%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20D%20fill%3A%233a49ab%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20E%20fill%3A%233a49ab%2Ccolor%3A%23fff%2Cstroke-width%3A0%0Astyle%20F%20fill%3A%233a49ab%2Ccolor%3A%23fff%2Cstroke-width%3A0"}),F])}const B=n(r,[["render",A]]);export{E as __pageData,B as default};
